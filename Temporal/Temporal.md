Temporal это платформа, которая гарантирует надёжное и отказоустойчивое выполнение кода приложения.
# Workflow
Workflow это абстракция Temporal, с помощью которой создаются приложения. Workflow задаются кодом, написанным на языке программирования. Workflow устойчивы: они могут выполнятся на протяжении очень длительного времени. В случае сбоя приложения Temporal восстанавливает состояние, в котором оно находилось до отказа, и продолжает выполнение.

По своей сути Workflow это просто набор определённых шагов. Описание этих шагов представляет собой написанный код в приложении, называемый Workflow Definition. Каждый отдельный запуск Workflow называется Workflow Execution. У каждого Workflow есть имя, которое внутри Temporal называется его типом. Шаги, составляющие Workflow, могут сами быть Workflow.

Свойства, которыми часто обладают Workflow:
- Длительный процесс - от нескольких часов, до нескольких недель и дольше.
- Условная логика - есть точки принятия решений и разные пути выполнения в зависимости от результата.
- Наличие циклов - возврат к уже пройденным шагом, их повторное выполнение.
- Необходимость вмешательства человека - личная проверка данных, подтверждение операции и т. д.
- Взаимодействие с внешними системами.

Workflow должны быть детерминированными. Каждый запуск Workflow должен для одинаковых входных данных возвращать одинаковый результат.
# Temporal Platform
Состоит из клиентов и Temporal Server
### Клиенты
1) Temporal CLI.
2) Temporal Web UI - пользовательский интерфейс в браузере, по сути панель администратора.
3) Temporal Client (из SDK), как часть нашего приложения.

### Temporal Server
1) Frontend сервис.
2) Backend сервисы.

Frontend сервис является шлюзом API для клиентов. Взаимодействие "Клиент - Frontend сервис" и "Frontend сервис - Backend сервисы" происходит через gRPC, формат передачи данных - Protocol Buffers, возможно использование TLS со взаимной проверкой сертификатов.
# Temporal Cluster
Для полноценной работы приложения вместе с запущенным Temporal Server должны также работать дополнительные компоненты. Всё вместе называется **Temporal Cluster**. Дополнительные компоненты это:
- База данных  - единственный обязательный компонент, хранит состояние всех Workflow Execution, и события, связанные с ними.
- Elasticsearch - быстрый поиск по Workflow Execution. Полезен в случае, если в системе запущены миллионы Workflow, и нужно быстро находить нужные по заданным критериям.
- Prometheus - сбор статистики работы кластера.
- Grafana - дашборды для просмотра метрик.

# Worker
Temporal Cluster не выполняет никакой бизнес логики.

Код запускается в Worker, которые работают вместе с нашим приложением на отдельных серверах. В коде приложения может содержаться инициализация Worker, Workflow Definition, запуск других Workflow.

Temporal занимается оркестрацией множества Worker. Запуск большого количества серверов с работающими Worker обеспечивает масштабируемость и отказоустойчивость.

Worker устанавливает постоянное соединение с кластером Temporal и начинает опрашивать очередь задач (Task).

Чтобы инициализировать Worker нужно:
1) Temporal Client - используется для взаимодействия с Temporal Cluster
2) Название очереди задач
3) Название интерфейса, который задаёт Workflow Definition

# Activity
Activity инкапсулируют бизнес-логику, в результате выполнения которой может произойти сбой или какая-либо другая ошибка. В отличие от Workflow, Activity не обязательно быть детерминированными.

Activity вызываются из Workflow Definition. Workflow не исполняет Activity самостоятельно, вместо этого он делает запрос к Temporal Cluster, чтобы запланировать выполнение Activity.

Если во время выполнения Activity происходит ошибка, будет произведена попытка повторного выполнения.
# SDK
Workflow пишутся на языке программирования. Код, составляющий Workflow, обращается к Temporal API, который, в свою очередь, обращается к Temporal Client. У каждого языка программирования будет своя реализация этих компонентов, которая распространяется в виде библиотеки, иными словами - в виде SDK.

В Java SDK Workflow Defenition создаётся через определение интерфейса:
``` kotlin
package temoralsandbox  
  
import io.temporal.workflow.WorkflowInterface  
import io.temporal.workflow.WorkflowMethod  
  
@WorkflowInterface  
interface Greeting {  
  
    @WorkflowMethod  
    fun greetSomeone(name: String): String  
}
```
Название интерфейса используется как тип Workflow. Входные параметры и возвращаемые значения должны быть сериализуемыми (Jackson JSON).

Аналогично для Activity Definition:
``` kotlin
package temoralsandbox.activity  
  
import io.temporal.activity.ActivityInterface  
import io.temporal.activity.ActivityMethod  
  
@ActivityInterface  
interface GreetingActivities {  
  
    @ActivityMethod  
    fun getGreetingInSpanish(name: String): String  
}
```